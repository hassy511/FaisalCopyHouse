SELECT * FROM  PURCHASE_DETAIL
select *From PURCHASE_MASTER 


select PURCHASE_MASTER_ID from PURCHASE_MASTER WHERE PURCHASE_MASTER_ID ='0'

BEGIN TRY 
                         BEGIN TRANSACTION IF EXISTS (select PURCHASE_MASTER_ID from PURCHASE_MASTER WHERE PURCHASE_MASTER_ID ='0') 
            BEGIN
                UPDATE PURCHASE_MASTER SET DATE = '10/17/2024 9:09:59 PM',   SUPPLIER_ID = '2106',
                DESCRIPTION = 'TEES',
                CREDIT_DAYS = '2',
                ITEM_TYPE = 'cash',  -- Include item type
                MODIFICATION_DATE = GETDATE(),MODIFIED_BY = '1'
                WHERE PURCHASE_MASTER_ID = '0';
            END
            ELSE
            BEGIN
                INSERT INTO PURCHASE_MASTER (DATE,SUPPLIER_ID,DESCRIPTION,CREDIT_DAYS,ITEM_TYPE,CREATION_DATE,CREATED_BY,INVOICE_NO) 
                VALUES 
    
                     ('10/17/2024 9:09:59 PM','2106',
                 'TEES',
                '2', 'cash', GETDATE(),'1','PI-1-2024')
            END
            
            DELETE FROM LEDGERS WHERE REF_ID = 0 AND ENTRY_OF = 'PURCHASES'
            
            INSERT INTO LEDGERS(DATE, COA_ID, REF_ID, ENTRY_OF, FOLIO, DEBIT, CREDIT, DESCRIPTIONS, CREATED_BY, CREATION_DATE, COMPANY_ID)
            VALUES('10/17/2024 9:09:59 PM','2106',(SELECT MAX(PURCHASE_MASTER_ID) FROM PURCHASE_MASTER),'PURCHASES','PI-1-2024',
            0,'726','P.I # PI-1-2024 /2 DAYS PAYMENT)','1',GETDATE(),1);
            
            INSERT INTO LEDGERS(DATE, COA_ID, REF_ID, ENTRY_OF, FOLIO, DEBIT, CREDIT, DESCRIPTIONS, CREATED_BY, CREATION_DATE, COMPANY_ID)
            VALUES('10/17/2024 9:09:59 PM','24',(SELECT MAX(PURCHASE_MASTER_ID) FROM PURCHASE_MASTER),'PURCHASES','PI-1-2024',
            '726',0,'P.I # PI-1-2024 /2 DAYS PAYMENT)','1',GETDATE(),1);
			
			DELETE FROM PURCHASE_DETAIL WHERE PURCHASE_MASTER_ID = '0'
			
			INSERT INTO PURCHASE_DETAIL (PURCHASE_MASTER_ID,PRODUCT_ID,QTY,RATE) VALUES 
            ((SELECT MAX(PURCHASE_MASTER_ID) FROM PURCHASE_MASTER),'DWD:2342','22',
                '33'); COMMIT TRANSACTION 
                    END TRY 
                BEGIN CATCH 
                        IF @@TRANCOUNT > 0 
                        ROLLBACK TRANSACTION 
                END CATCH

				SELECT* FROM P

				

















SELECT * FROM PRODUCT_MASTER
SELECT * FROM PURCHASE_MASTER



SELECT* FROM PRODUCTION_MASTER


ALTER TABLE PURCHASE_MASTER
DROP COLUMN VEHICLE_NO

SELECT *FROM PURCHASE_DETAIL

EXEC sp_rename 'PURCHASE_DETAIL.MATERIAL_ID', 'PRODUCT_ID', 'COLUMN';


SELECT A.PURCHASE_MASTER_ID AS [ID],A.INVOICE_NO AS [INVOICE #],
               A.[DATE],B.COA_NAME AS [SUPPLIER],A.[DESCRIPTION],
               A.CREDIT_DAYS,A.SUPPLIER_ID
               FROM PURCHASE_MASTER A
               INNER JOIN COA B ON A.SUPPLIER_ID = B.COA_ID
               ORDER BY PURCHASE_MASTER_ID DESC

SELECT A.PURCHASE_MASTER_ID AS [ID],A.INVOICE_NO AS [INVOICE #],
            A.[DATE],B.COA_NAME AS [SUPPLIER],A.[DESCRIPTION],
            A.CREDIT_DAYS,A.SUPPLIER_ID
            FROM PURCHASE_MASTER A
            INNER JOIN COA B ON A.SUPPLIER_ID = B.COA_ID
            ORDER BY PURCHASE_MASTER_ID DESC



			SELECT A.[ID], A.[DATE], B.PRODUCT_MASTER_ID, C.PRODUCT_NAME, B.QTY
            FROM PRODUCTION_MASTER A
            INNER JOIN PRODUCTION_DETAIL B ON A.ID = B.PRODUCTION_MASTER_ID
            INNER JOIN PRODUCT_MASTER C ON B.PRODUCT_MASTER_ID = C.PM_ID
            ORDER BY A.ID DESC



			SELECT 
    PM.PURCHASE_MASTER_ID AS [ID],
    PM.INVOICE_NO AS [INVOICE #],
    PM.[DATE],
    C.COA_NAME AS [SUPPLIER],
    PM.[DESCRIPTION],
    PM.CREDIT_DAYS,
    PM.SUPPLIER_ID,
    PRD.PRODUCT_MASTER_ID,
    P.PRODUCT_NAME,
    PRD.QTY
FROM 
    PURCHASE_MASTER PM
INNER JOIN 
    COA C ON PM.SUPPLIER_ID = C.COA_ID
INNER JOIN 
    PRODUCTION_MASTER PR ON PM.PURCHASE_MASTER_ID = PR.ID -- Assuming relation exists
INNER JOIN 
    PRODUCTION_DETAIL PRD ON PR.ID = PRD.PRODUCTION_MASTER_ID
INNER JOIN 
    PRODUCT_MASTER P ON PRD.PRODUCT_MASTER_ID = P.PM_ID
ORDER BY 
    PM.PURCHASE_MASTER_ID DESC;

	









	


SELECT '0' AS [id],'--SELECT PRODUCT--' AS [name]
                UNION ALL
                SELECT PM_ID AS [id],PRODUCT_NAME+':'+PRODUCT_CODE AS [name] 
                FROM PRODUCT_MASTER


			

			 SELECT '0' AS [id],'--SELECT PRODUCT--' AS [name]
                UNION ALL
                SELECT PM_ID AS [id],PRODUCT_NAME+':'+PRODUCT_CODE AS [name] 
                FROM PRODUCT_MASTER


				SELECT '0' AS [id],'--SELECT SUPPLIER--' AS [name]
                UNION
                SELECT COA_ID AS [id],COA_NAME AS [name] FROM COA 



				ALTER TABLE PURCHASE_MASTER
ADD ITEM_TYPE VARCHAR(50);

